# DolphinScheduler 工作流监控配置文件

# =============================================================================
# DolphinScheduler API 配置
# =============================================================================
dolphinscheduler:
  # API 地址（格式: http://host:port/dolphinscheduler）
  api_url: "http://localhost:12345/dolphinscheduler"
  # 认证 Token (可通过环境变量 DS_TOKEN 覆盖)
  # 获取方式: DolphinScheduler UI -> 安全中心 -> Token管理 -> 创建Token
  token: ""

# =============================================================================
# 监控配置
# =============================================================================
monitor:
  # 检查间隔（秒）
  check_interval: 60
  # 是否启用持续监控模式（false则只执行一次检查）
  continuous_mode: true
  # 单次检查模式下的超时时间（秒）
  timeout: 300

# =============================================================================
# 重试/恢复配置
# =============================================================================
retry:
  # 最大自动恢复次数（针对同一个工作流实例）
  # 超过此次数后不再自动恢复，需要手动处理
  max_recovery_attempts: 3
  # 恢复操作间隔（秒）- 多个工作流恢复之间的等待时间
  recovery_interval: 30
  # 是否启用自动恢复（false则只记录日志，不执行恢复）
  auto_recovery: true

# =============================================================================
# 需要监控的项目和工作流配置
# =============================================================================
#
# ┌─────────────────────────────────────────────────────────────────────────┐
# │  【重要说明】                                                            │
# │                                                                          │
# │  配置中使用的是 DolphinScheduler UI 上显示的【名称】，不是 code！        │
# │                                                                          │
# │  - 项目名称: UI 上 "项目管理" 页面显示的项目名称                         │
# │  - 工作流名称: UI 上 "工作流定义" 页面显示的工作流名称                   │
# │                                                                          │
# │  程序启动时会自动将名称转换为对应的 project_code 和 process_code         │
# └─────────────────────────────────────────────────────────────────────────┘
#
# 【如何在 UI 上查看名称】
#
#   1. 查看项目名称:
#      - 登录 DolphinScheduler -> 项目管理
#      - "项目名称" 列显示的就是要配置的名称
#      - 例如: "数据仓库项目"、"ETL任务"、"report-system"
#
#   2. 查看工作流名称:
#      - 进入具体项目 -> 工作流定义
#      - "工作流名称" 列显示的就是要配置的名称
#      - 例如: "每日数据同步"、"用户报表生成"、"daily_etl_job"
#
# =============================================================================

projects:

  # ===========================================================================
  # 示例1: 监控项目下的【所有】工作流
  # ===========================================================================
  # 使用场景:
  #   - 整个项目的所有工作流都需要监控
  #   - 新增工作流时自动纳入监控，无需修改配置
  #
  # 配置说明:
  #   - monitor_all: true  -> 监控该项目下所有工作流
  #   - workflows: []      -> 留空（monitor_all=true时会忽略此配置）
  # ---------------------------------------------------------------------------

  # 数据仓库项目:
  #   workflows: []
  #   monitor_all: true

  # ===========================================================================
  # 示例2: 只监控项目下的【指定】工作流
  # ===========================================================================
  # 使用场景:
  #   - 项目中只有部分关键工作流需要监控
  #   - 需要精确控制监控范围
  #
  # 配置说明:
  #   - monitor_all: false -> 只监控 workflows 列表中的工作流
  #   - workflows: [...]   -> 列出需要监控的工作流名称
  # ---------------------------------------------------------------------------

  # 订单系统:
  #   workflows:
  #     - 订单数据同步            # UI上显示的工作流名称
  #     - 每日结算任务            # UI上显示的工作流名称
  #     - 库存更新                # UI上显示的工作流名称
  #   monitor_all: false

  # ===========================================================================
  # 示例3: 完整的多项目配置实例
  # ===========================================================================
  # 假设 DolphinScheduler UI 上有以下项目和工作流:
  #
  # 【项目: 生产环境-数据中台】
  #   ├── 工作流: ODS层数据采集
  #   ├── 工作流: DWD层数据清洗
  #   ├── 工作流: DWS层数据汇总
  #   └── 工作流: ADS层报表生成
  #
  # 【项目: 生产环境-业务系统】
  #   ├── 工作流: 用户行为分析
  #   ├── 工作流: 订单统计报表
  #   └── 工作流: 营销效果分析
  #
  # 【项目: test-project】(测试项目，不需要监控)
  #   └── 工作流: test_workflow
  # ---------------------------------------------------------------------------

  # 生产环境-数据中台:                # <- 对应UI上的项目名称
  #   workflows: []                   # <- 留空
  #   monitor_all: true               # <- 监控该项目所有工作流（4个）

  # 生产环境-业务系统:                # <- 对应UI上的项目名称
  #   workflows:                      # <- 只监控指定的2个工作流
  #     - 用户行为分析                # <- 对应UI上的工作流名称
  #     - 订单统计报表                # <- 对应UI上的工作流名称
  #   monitor_all: false

  # 注意: test-project 项目未配置，所以不会被监控

  # ===========================================================================
  # 示例4: 英文名称项目配置
  # ===========================================================================
  # 如果项目/工作流使用英文命名:
  # ---------------------------------------------------------------------------

  # data-platform:
  #   workflows:
  #     - daily_etl_job
  #     - hourly_sync_task
  #     - weekly_report_gen
  #   monitor_all: false

  # bi-reports:
  #   workflows: []
  #   monitor_all: true

  # ===========================================================================
  # 【您的实际配置】- 请修改下面的配置
  # ===========================================================================
  # 将 "您的项目名称" 替换为 DolphinScheduler UI 上实际显示的项目名称
  # 将 "您的工作流名称" 替换为实际的工作流名称
  # ---------------------------------------------------------------------------

  default_project:
    workflows: []
    monitor_all: true

# =============================================================================
# 日志配置
# =============================================================================
logging:
  # 日志级别: DEBUG, INFO, WARNING, ERROR
  level: INFO
  # 日志文件路径（相对于项目根目录）
  file: logs/monitor.log
  # 日志文件最大大小（MB）
  max_size: 10
  # 保留的日志文件数量
  backup_count: 5

# =============================================================================
# 通知配置（可选，暂未实现）
# =============================================================================
notification:
  # 是否启用通知
  enabled: false
  # 通知类型: webhook, email
  type: webhook
  # Webhook URL（如企业微信、钉钉机器人）
  webhook_url: ""
  # 邮件配置
  email:
    smtp_server: ""
    smtp_port: 587
    username: ""
    password: ""
    recipients: []
